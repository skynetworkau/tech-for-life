<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Interview Practice | Tech for Life</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        h1 {
            color: #4fc3f7;
            font-size: 2rem;
            text-shadow: 0 2px 10px rgba(79, 195, 247, 0.3);
        }

        .home-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 10px 25px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .home-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #4fc3f7;
            transform: translateY(-2px);
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h2 {
            color: #4fc3f7;
            font-size: 2rem;
            margin-bottom: 20px;
        }

        h3 {
            color: #81c784;
            font-size: 1.3rem;
            margin: 25px 0 15px;
        }

        .info-box {
            background: rgba(79, 195, 247, 0.1);
            border-left: 4px solid #4fc3f7;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .warning-box {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .success-box {
            background: rgba(129, 199, 132, 0.1);
            border-left: 4px solid #81c784;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        li {
            margin: 10px 0;
            color: #b0bec5;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .video-container {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        #cameraPreview, #recordingPreview {
            width: 100%;
            max-height: 600px;
            display: block;
            transform: scaleX(-1); /* Mirror effect for more natural view */
        }

        .checklist {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .checklist-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .checklist-item.checked {
            border-color: #81c784;
            background: rgba(129, 199, 132, 0.1);
        }

        .checkbox {
            width: 30px;
            height: 30px;
            min-width: 30px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checklist-item.checked .checkbox {
            background: #81c784;
            border-color: #81c784;
        }

        .checkbox::after {
            content: '‚úì';
            color: white;
            font-size: 20px;
            font-weight: bold;
            display: none;
        }

        .checklist-item.checked .checkbox::after {
            display: block;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .tip-card {
            background: rgba(79, 195, 247, 0.1);
            border: 1px solid rgba(79, 195, 247, 0.3);
            border-radius: 12px;
            padding: 15px;
            font-size: 0.95rem;
        }

        .recording-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 25px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
        }

        .timer {
            font-size: 2rem;
            font-weight: bold;
            color: #4fc3f7;
            min-width: 120px;
            text-align: center;
        }

        .recording-indicator {
            width: 15px;
            height: 15px;
            background: #f44336;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8rem;
            font-weight: bold;
            color: #4fc3f7;
            z-index: 10;
        }

        .question-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.4);
        }

        .question-display h3 {
            color: white;
            font-size: 1.8rem;
            margin: 0;
        }

        .keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .keyword {
            background: rgba(79, 195, 247, 0.2);
            border: 1px solid #4fc3f7;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #4fc3f7;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4fc3f7, #81c784);
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(79, 195, 247, 0.1);
            border: 2px solid rgba(79, 195, 247, 0.3);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            color: #4fc3f7;
            margin: 10px 0;
        }

        .stat-label {
            color: #b0bec5;
            font-size: 0.95rem;
        }

        .pip-video {
            position: absolute;
            bottom: 80px;
            right: 20px;
            width: 200px;
            border-radius: 10px;
            border: 3px solid #4fc3f7;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 5;
        }

        .tip-banner {
            background: rgba(129, 199, 132, 0.2);
            border: 2px solid #81c784;
            border-radius: 12px;
            padding: 15px 20px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .tip-icon {
            font-size: 2rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            .card {
                padding: 25px;
            }

            .pip-video {
                width: 120px;
                bottom: 100px;
            }

            .recording-controls {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }

            .timer {
                font-size: 1.5rem;
            }

            .countdown-overlay {
                font-size: 5rem;
            }

            .btn {
                width: 100%;
                margin: 5px 0;
            }
        }

        .achievement {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1a1a2e;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 8px 32px rgba(255, 215, 0, 0.4);
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .privacy-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(129, 199, 132, 0.2);
            border: 1px solid #81c784;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #81c784;
            margin: 10px 0;
        }

        .star-method {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .star-item {
            background: rgba(102, 126, 234, 0.1);
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
        }

        .star-item strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé• AI Interview Practice</h1>
            <a href="../../index.html" class="home-btn">
                <span>‚Üê</span> Home
            </a>
        </header>

        <!-- Introduction Screen -->
        <div id="introScreen" class="screen active">
            <div class="card">
                <h2>Welcome to AI Interview Practice</h2>
                <p style="font-size: 1.1rem; margin-bottom: 20px;">
                    Get ready for the future of job interviews! Many companies now use AI-powered video interviews
                    (like HireVue and Spark Hire) to screen candidates. This tool helps you practise in a safe,
                    private environment.
                </p>

                <div class="info-box">
                    <h3>ü§ñ What AI Analyses in Video Interviews</h3>
                    <ul>
                        <li><strong>Eye contact:</strong> Are you looking at the camera?</li>
                        <li><strong>Tone of voice:</strong> Confident, enthusiastic, clear?</li>
                        <li><strong>Keywords:</strong> Using relevant industry terms</li>
                        <li><strong>Facial expressions:</strong> Smiling, engaged, professional</li>
                        <li><strong>Answer structure:</strong> Clear beginning, middle, and end</li>
                        <li><strong>Pace of speech:</strong> Not too fast, not too slow</li>
                    </ul>
                </div>

                <h3>üí° Tips Before You Start</h3>
                <div class="tips-grid">
                    <div class="tip-card">
                        <strong>üì∏ Look at the lens</strong><br>
                        Not at your own face on screen - this is like making eye contact!
                    </div>
                    <div class="tip-card">
                        <strong>üí° Check your lighting</strong><br>
                        Face a window or lamp. Avoid backlighting!
                    </div>
                    <div class="tip-card">
                        <strong>üé® Clean background</strong><br>
                        Plain wall or tidy room. No distractions.
                    </div>
                    <div class="tip-card">
                        <strong>üòä Smile!</strong><br>
                        AI detects enthusiasm. A natural smile helps!
                    </div>
                    <div class="tip-card">
                        <strong>üéØ Use STAR method</strong><br>
                        Situation, Task, Action, Result - we'll remind you!
                    </div>
                    <div class="tip-card">
                        <strong>üó£Ô∏è Speak clearly</strong><br>
                        Take your time. Slow and clear beats fast and mumbled.
                    </div>
                </div>

                <div class="warning-box">
                    <h3>üîí Your Privacy Matters</h3>
                    <p><strong>Your video never leaves your device.</strong> Everything is recorded and stored locally
                    in your browser. Nothing is uploaded to any server. You can delete recordings at any time.</p>
                    <div class="privacy-badge">
                        üîê 100% Private & Local
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="goToSetup()">Start Practice Session</button>
                </div>
            </div>
        </div>

        <!-- Setup Check Screen -->
        <div id="setupScreen" class="screen">
            <div class="card">
                <h2>Setup Check</h2>
                <p>Let's make sure everything is working properly before we start.</p>

                <div class="video-container">
                    <video id="cameraPreview" autoplay playsinline muted></video>
                    <div id="setupCountdown" class="countdown-overlay" style="display: none;"></div>
                </div>

                <div class="checklist" id="setupChecklist">
                    <div class="checklist-item" data-check="camera">
                        <div class="checkbox"></div>
                        <div>
                            <strong>Camera is working</strong><br>
                            <small>Can you see yourself in the preview above?</small>
                        </div>
                    </div>
                    <div class="checklist-item" data-check="lighting">
                        <div class="checkbox"></div>
                        <div>
                            <strong>Good lighting</strong><br>
                            <small>Your face should be clearly visible, not too dark or bright</small>
                        </div>
                    </div>
                    <div class="checklist-item" data-check="background">
                        <div class="checkbox"></div>
                        <div>
                            <strong>Clean background</strong><br>
                            <small>Nothing distracting behind you</small>
                        </div>
                    </div>
                    <div class="checklist-item" data-check="position">
                        <div class="checkbox"></div>
                        <div>
                            <strong>Good framing</strong><br>
                            <small>Head and shoulders visible, centred in frame</small>
                        </div>
                    </div>
                </div>

                <div class="tip-banner">
                    <span class="tip-icon">üí°</span>
                    <div>
                        <strong>Pro Tip:</strong> Position yourself so you're looking slightly up at the camera.
                        This is more flattering and engaging than looking down!
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="goToIntro()">Back</button>
                    <button class="btn" id="startPracticeBtn" onclick="startPractice()" disabled>
                        Continue to Practice
                    </button>
                </div>
            </div>
        </div>

        <!-- Practice Screen -->
        <div id="practiceScreen" class="screen">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-bottom: 20px;">
                    <h2 style="margin: 0;">Question <span id="questionNumber">1</span></h2>
                    <div class="privacy-badge">
                        üîê Recording locally - not uploaded
                    </div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 10%;"></div>
                </div>

                <div class="question-display" id="questionDisplay">
                    <h3 id="currentQuestion">Tell me about yourself</h3>
                </div>

                <div class="info-box">
                    <strong>üí° Remember the STAR Method:</strong>
                    <div class="star-method">
                        <div class="star-item">
                            <strong>S - Situation</strong>
                            Set the context
                        </div>
                        <div class="star-item">
                            <strong>T - Task</strong>
                            What needed to be done?
                        </div>
                        <div class="star-item">
                            <strong>A - Action</strong>
                            What did YOU do?
                        </div>
                        <div class="star-item">
                            <strong>R - Result</strong>
                            What was the outcome?
                        </div>
                    </div>
                </div>

                <div id="keywordsHint" class="tip-banner" style="display: none;">
                    <span class="tip-icon">üéØ</span>
                    <div>
                        <strong>Keywords to include:</strong>
                        <div class="keywords" id="keywordsList"></div>
                    </div>
                </div>

                <div class="video-container">
                    <video id="recordingPreview" autoplay playsinline muted></video>
                    <div id="countdown" class="countdown-overlay" style="display: none;"></div>
                    <div class="recording-controls" id="recordingControls" style="display: none;">
                        <div class="recording-indicator"></div>
                        <div class="timer" id="recordingTimer">2:00</div>
                        <button class="btn" onclick="finishRecording()">Finish Early</button>
                    </div>
                </div>

                <div class="tip-banner">
                    <span class="tip-icon">üëÄ</span>
                    <div>
                        <strong>Remember:</strong> Look at the camera lens (the small dot), not at yourself on the screen.
                        This creates "eye contact" with the interviewer!
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" id="readyBtn" onclick="startCountdown()">I'm Ready - Start Recording</button>
                    <button class="btn btn-secondary" onclick="skipQuestion()">Skip This Question</button>
                </div>
            </div>
        </div>

        <!-- Feedback Screen -->
        <div id="feedbackScreen" class="screen">
            <div class="card">
                <h2>Watch Your Response</h2>

                <div class="question-display">
                    <h3 id="feedbackQuestion">Question asked</h3>
                </div>

                <div class="video-container">
                    <video id="playbackVideo" controls style="transform: scaleX(-1);"></video>
                </div>

                <div class="info-box">
                    <h3>üìù Self-Assessment</h3>
                    <p>Be honest with yourself - this is how you improve!</p>
                </div>

                <div class="checklist" id="feedbackChecklist">
                    <div class="checklist-item" data-check="eye-contact">
                        <div class="checkbox"></div>
                        <div>
                            <strong>I looked at the camera</strong><br>
                            <small>Not at the screen or away</small>
                        </div>
                    </div>
                    <div class="checklist-item" data-check="structure">
                        <div class="checkbox"></div>
                        <div>
                            <strong>My answer had clear structure</strong><br>
                            <small>Beginning, middle, and end (or used STAR method)</small>
                        </div>
                    </div>
                    <div class="checklist-item" data-check="clarity">
                        <div class="checkbox"></div>
                        <div>
                            <strong>I spoke clearly and at a good pace</strong><br>
                            <small>Not too fast, not mumbling</small>
                        </div>
                    </div>
                    <div class="checklist-item" data-check="confidence">
                        <div class="checkbox"></div>
                        <div>
                            <strong>I appeared confident and enthusiastic</strong><br>
                            <small>Smiled, showed energy, sounded positive</small>
                        </div>
                    </div>
                    <div class="checklist-item" data-check="content">
                        <div class="checkbox"></div>
                        <div>
                            <strong>My answer was relevant and specific</strong><br>
                            <small>Included examples, not just general statements</small>
                        </div>
                    </div>
                </div>

                <div class="tip-banner">
                    <span class="tip-icon">üåü</span>
                    <div>
                        <strong>You've got this!</strong> Every practice session makes you better. Even professional
                        speakers practise their delivery!
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="retryQuestion()">‚Üª Try This Question Again</button>
                    <button class="btn" onclick="nextQuestion()">Next Question ‚Üí</button>
                    <button class="btn btn-secondary" onclick="deleteRecording()">üóëÔ∏è Delete Recording</button>
                </div>
            </div>
        </div>

        <!-- Summary Screen -->
        <div id="summaryScreen" class="screen">
            <div class="card">
                <h2>üéâ Practice Session Complete!</h2>

                <div id="achievementBanner" style="display: none;"></div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Questions Practised</div>
                        <div class="stat-number" id="totalQuestions">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Self-Assessment Score</div>
                        <div class="stat-number" id="averageScore">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Confidence Level</div>
                        <div class="stat-number" id="confidenceLevel">üìà</div>
                    </div>
                </div>

                <div class="progress-bar" style="height: 40px; border-radius: 20px;">
                    <div class="progress-fill" id="confidenceFill" style="display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.1rem;">
                        <span id="confidenceText">Building Confidence...</span>
                    </div>
                </div>

                <div class="success-box">
                    <h3>üí™ What You're Doing Well</h3>
                    <ul id="strengthsList">
                        <li>You're taking the time to practise - that's already putting you ahead!</li>
                    </ul>
                </div>

                <div class="info-box">
                    <h3>üéØ Areas to Focus On</h3>
                    <ul id="improvementsList">
                        <li>Keep practising to build confidence and refine your answers</li>
                    </ul>
                </div>

                <div class="tip-banner">
                    <span class="tip-icon">üåü</span>
                    <div>
                        <strong>Remember:</strong> The AI judges, but we don't! Every interview is a learning opportunity.
                        You're building skills that will serve you for life.
                    </div>
                </div>

                <h3>üìö Want to Learn More?</h3>
                <div class="tips-grid">
                    <div class="tip-card">
                        <strong>STAR Method Guide</strong><br>
                        Research how to structure behavioural interview answers effectively
                    </div>
                    <div class="tip-card">
                        <strong>Common Interview Questions</strong><br>
                        Prepare answers for the most frequently asked questions
                    </div>
                    <div class="tip-card">
                        <strong>Body Language Tips</strong><br>
                        Learn how to project confidence through non-verbal communication
                    </div>
                    <div class="tip-card">
                        <strong>Industry Research</strong><br>
                        Learn keywords and trends in your target industry
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn" onclick="restartPractice()">üîÑ Practice More Questions</button>
                    <button class="btn btn-secondary" onclick="goToIntro()">Back to Start</button>
                    <a href="../../index.html" class="btn btn-secondary" style="text-decoration: none; display: inline-block;">
                        Home
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        const state = {
            currentQuestionIndex: 0,
            questionsAsked: [],
            recordings: [],
            selfAssessmentScores: [],
            mediaStream: null,
            mediaRecorder: null,
            recordedChunks: [],
            currentRecordingBlob: null,
            recordingStartTime: null,
            timerInterval: null,
            prepTime: 3, // seconds
            answerTime: 120 // seconds (2 minutes)
        };

        // Question Bank
        const questions = [
            {
                question: "Tell me about yourself",
                keywords: ["background", "experience", "skills", "goals", "passion"],
                tip: "Keep it professional and relevant to the job. Focus on your journey and what makes you unique."
            },
            {
                question: "Why do you want this job?",
                keywords: ["company", "role", "growth", "opportunity", "skills", "contribute"],
                tip: "Show you've researched the company. Connect your goals with what they offer."
            },
            {
                question: "Describe a time you worked in a team to achieve a goal",
                keywords: ["collaboration", "communication", "role", "outcome", "teamwork"],
                tip: "Perfect for STAR method! Be specific about your contribution to the team."
            },
            {
                question: "What are your greatest strengths?",
                keywords: ["skills", "achievements", "examples", "value", "unique"],
                tip: "Choose 2-3 strengths relevant to the job. Back each up with a real example."
            },
            {
                question: "What is your biggest weakness?",
                keywords: ["improvement", "learning", "growth", "overcome", "develop"],
                tip: "Be honest but strategic. Show how you're actively working to improve."
            },
            {
                question: "Tell me about a challenge you overcame",
                keywords: ["problem", "solution", "action", "result", "learned"],
                tip: "Focus on what YOU did to solve it. Show resilience and problem-solving skills."
            },
            {
                question: "Where do you see yourself in 5 years?",
                keywords: ["growth", "development", "goals", "company", "career path"],
                tip: "Show ambition but be realistic. Align your goals with potential at the company."
            },
            {
                question: "Why should we hire you?",
                keywords: ["unique", "value", "skills", "contribution", "fit", "results"],
                tip: "This is your sales pitch! Summarise your key strengths and what makes you the best fit."
            },
            {
                question: "Describe a time you dealt with a difficult customer or situation",
                keywords: ["patience", "communication", "resolution", "professional", "outcome"],
                tip: "Show emotional intelligence and problem-solving. Focus on staying professional."
            },
            {
                question: "How do you handle stress and pressure?",
                keywords: ["strategies", "manage", "prioritise", "example", "balance"],
                tip: "Give specific techniques you use. Include a real example of handling pressure successfully."
            },
            {
                question: "Tell me about a time you showed leadership",
                keywords: ["initiative", "guided", "responsibility", "team", "outcome"],
                tip: "Leadership isn't just for managers. Show how you took initiative or helped others."
            },
            {
                question: "What motivates you?",
                keywords: ["passion", "drive", "goals", "achievement", "purpose"],
                tip: "Be genuine! Connect your motivation to the type of work you'd be doing."
            },
            {
                question: "Describe a time you made a mistake and how you handled it",
                keywords: ["accountability", "learned", "corrected", "improved", "honest"],
                tip: "Everyone makes mistakes. Focus on what you learned and how you prevented it happening again."
            },
            {
                question: "How do you prioritise your work?",
                keywords: ["organisation", "time management", "deadlines", "systems", "efficiency"],
                tip: "Describe your actual process. Tools, methods, how you decide what's urgent vs important."
            },
            {
                question: "What makes you unique compared to other candidates?",
                keywords: ["perspective", "experience", "skills", "passion", "value"],
                tip: "This is your differentiator. What combination of skills/experience do you bring that others might not?"
            }
        ];

        // Screen Navigation
        function goToIntro() {
            showScreen('introScreen');
            stopCamera();
        }

        function goToSetup() {
            showScreen('setupScreen');
            requestCameraAccess();
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Camera Functions
        async function requestCameraAccess() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: true
                });
                state.mediaStream = stream;
                document.getElementById('cameraPreview').srcObject = stream;
                document.getElementById('recordingPreview').srcObject = stream;

                // Enable camera checklist item automatically
                setTimeout(() => {
                    checkSetupItem('camera');
                }, 500);
            } catch (error) {
                alert('Unable to access camera and microphone. Please ensure you\'ve granted permission and try again.');
                console.error('Camera access error:', error);
            }
        }

        function stopCamera() {
            if (state.mediaStream) {
                state.mediaStream.getTracks().forEach(track => track.stop());
                state.mediaStream = null;
            }
        }

        // Setup Checklist
        function checkSetupItem(item) {
            const checklistItem = document.querySelector(`[data-check="${item}"]`);
            if (checklistItem) {
                checklistItem.classList.add('checked');
                checkIfSetupComplete();
            }
        }

        function checkIfSetupComplete() {
            const checkedItems = document.querySelectorAll('#setupChecklist .checklist-item.checked').length;
            const totalItems = document.querySelectorAll('#setupChecklist .checklist-item').length;

            if (checkedItems >= 2) { // At least camera and one other item
                document.getElementById('startPracticeBtn').disabled = false;
            }
        }

        // Add click handlers to setup checklist
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('#setupChecklist .checklist-item').forEach(item => {
                item.addEventListener('click', function() {
                    this.classList.toggle('checked');
                    checkIfSetupComplete();
                });
            });

            // Feedback checklist
            document.querySelectorAll('#feedbackChecklist .checklist-item').forEach(item => {
                item.addEventListener('click', function() {
                    this.classList.toggle('checked');
                });
            });
        });

        // Practice Functions
        function startPractice() {
            showScreen('practiceScreen');
            loadNextQuestion();
        }

        function loadNextQuestion() {
            // Get a random question that hasn't been asked yet
            let availableQuestions = questions.filter((q, index) =>
                !state.questionsAsked.includes(index)
            );

            if (availableQuestions.length === 0) {
                // All questions asked, show summary
                showSummary();
                return;
            }

            const randomQuestion = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
            state.currentQuestionIndex = questions.indexOf(randomQuestion);
            state.questionsAsked.push(state.currentQuestionIndex);

            const question = questions[state.currentQuestionIndex];
            document.getElementById('currentQuestion').textContent = question.question;
            document.getElementById('questionNumber').textContent = state.questionsAsked.length;

            // Show keywords if available
            if (question.keywords && question.keywords.length > 0) {
                document.getElementById('keywordsHint').style.display = 'flex';
                const keywordsList = document.getElementById('keywordsList');
                keywordsList.innerHTML = question.keywords.map(kw =>
                    `<span class="keyword">${kw}</span>`
                ).join('');
            } else {
                document.getElementById('keywordsHint').style.display = 'none';
            }

            // Update progress bar
            const progress = (state.questionsAsked.length / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            // Reset UI
            document.getElementById('readyBtn').style.display = 'inline-block';
            document.getElementById('countdown').style.display = 'none';
            document.getElementById('recordingControls').style.display = 'none';
        }

        function startCountdown() {
            document.getElementById('readyBtn').style.display = 'none';
            const countdownEl = document.getElementById('countdown');
            countdownEl.style.display = 'flex';

            let count = state.prepTime;
            countdownEl.textContent = count;

            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownEl.textContent = count;
                } else {
                    clearInterval(countdownInterval);
                    countdownEl.textContent = 'GO!';
                    setTimeout(() => {
                        countdownEl.style.display = 'none';
                        startRecording();
                    }, 500);
                }
            }, 1000);
        }

        function startRecording() {
            state.recordedChunks = [];

            const options = { mimeType: 'video/webm;codecs=vp9,opus' };
            if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                options.mimeType = 'video/webm';
            }

            state.mediaRecorder = new MediaRecorder(state.mediaStream, options);

            state.mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                    state.recordedChunks.push(event.data);
                }
            };

            state.mediaRecorder.onstop = () => {
                const blob = new Blob(state.recordedChunks, { type: 'video/webm' });
                state.currentRecordingBlob = blob;
                state.recordings.push({
                    questionIndex: state.currentQuestionIndex,
                    blob: blob,
                    timestamp: new Date()
                });
                showFeedback();
            };

            state.mediaRecorder.start();
            state.recordingStartTime = Date.now();
            document.getElementById('recordingControls').style.display = 'flex';

            // Start timer
            updateTimer();
            state.timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - state.recordingStartTime) / 1000);
            const remaining = Math.max(0, state.answerTime - elapsed);

            const minutes = Math.floor(remaining / 60);
            const seconds = remaining % 60;
            document.getElementById('recordingTimer').textContent =
                `${minutes}:${seconds.toString().padStart(2, '0')}`;

            if (remaining === 0) {
                finishRecording();
            }
        }

        function finishRecording() {
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
                state.timerInterval = null;
            }

            if (state.mediaRecorder && state.mediaRecorder.state !== 'inactive') {
                state.mediaRecorder.stop();
            }

            document.getElementById('recordingControls').style.display = 'none';
        }

        function skipQuestion() {
            if (confirm('Are you sure you want to skip this question?')) {
                loadNextQuestion();
            }
        }

        // Feedback Functions
        function showFeedback() {
            showScreen('feedbackScreen');

            const question = questions[state.currentQuestionIndex];
            document.getElementById('feedbackQuestion').textContent = question.question;

            // Set up playback
            const playbackVideo = document.getElementById('playbackVideo');
            playbackVideo.src = URL.createObjectURL(state.currentRecordingBlob);

            // Reset checklist
            document.querySelectorAll('#feedbackChecklist .checklist-item').forEach(item => {
                item.classList.remove('checked');
            });
        }

        function retryQuestion() {
            // Remove this question from asked list so it can be asked again
            const index = state.questionsAsked.indexOf(state.currentQuestionIndex);
            if (index > -1) {
                state.questionsAsked.splice(index, 1);
            }

            // Remove the recording
            state.recordings.pop();

            showScreen('practiceScreen');
            loadNextQuestion();
        }

        function nextQuestion() {
            // Calculate self-assessment score
            const checkedCount = document.querySelectorAll('#feedbackChecklist .checklist-item.checked').length;
            const totalCount = document.querySelectorAll('#feedbackChecklist .checklist-item').length;
            const score = (checkedCount / totalCount) * 100;
            state.selfAssessmentScores.push(score);

            loadNextQuestion();
        }

        function deleteRecording() {
            if (confirm('Are you sure you want to delete this recording?')) {
                URL.revokeObjectURL(document.getElementById('playbackVideo').src);
                state.recordings.pop();
                nextQuestion();
            }
        }

        // Summary Functions
        function showSummary() {
            showScreen('summaryScreen');
            stopCamera();

            const totalQuestions = state.questionsAsked.length;
            const avgScore = state.selfAssessmentScores.length > 0
                ? Math.round(state.selfAssessmentScores.reduce((a, b) => a + b, 0) / state.selfAssessmentScores.length)
                : 0;

            document.getElementById('totalQuestions').textContent = totalQuestions;
            document.getElementById('averageScore').textContent = avgScore + '%';

            // Confidence level
            let confidenceEmoji = 'üìà';
            let confidenceText = 'Building Confidence...';
            let confidencePercent = Math.min(100, totalQuestions * 15 + avgScore / 2);

            if (totalQuestions >= 5) {
                confidenceEmoji = 'üöÄ';
                confidenceText = 'Interview Ready!';
            } else if (totalQuestions >= 3) {
                confidenceEmoji = 'üí™';
                confidenceText = 'Getting Stronger!';
            }

            document.getElementById('confidenceLevel').textContent = confidenceEmoji;
            document.getElementById('confidenceFill').style.width = confidencePercent + '%';
            document.getElementById('confidenceText').textContent = confidenceText;

            // Achievement
            if (totalQuestions >= 5) {
                const achievementBanner = document.getElementById('achievementBanner');
                achievementBanner.innerHTML = `
                    <div class="achievement">
                        üèÜ Achievement Unlocked: Interview Warrior! üèÜ<br>
                        <small>You've completed 5+ practice questions - that's dedication!</small>
                    </div>
                `;
                achievementBanner.style.display = 'block';
            }

            // Strengths
            const strengthsList = document.getElementById('strengthsList');
            const strengths = [];

            if (totalQuestions >= 3) {
                strengths.push('You\'re committed to improvement - you practised multiple questions!');
            }
            if (avgScore >= 70) {
                strengths.push('Your self-assessment shows good critical thinking');
            }
            if (state.recordings.length === totalQuestions) {
                strengths.push('You completed all recordings - that shows persistence');
            }
            strengths.push('You\'re taking initiative to prepare - most candidates don\'t!');

            strengthsList.innerHTML = strengths.map(s => `<li>${s}</li>`).join('');

            // Improvements
            const improvementsList = document.getElementById('improvementsList');
            const improvements = [];

            if (avgScore < 60) {
                improvements.push('Focus on the areas you marked as needing work in your self-assessments');
            }
            if (totalQuestions < 5) {
                improvements.push('Practise more questions to build confidence and refine different answer types');
            }
            improvements.push('Record yourself answering the same question multiple times to perfect your delivery');
            improvements.push('Research the STAR method in more depth for behavioural questions');
            improvements.push('Watch your recordings and note specific areas (eye contact, pace, filler words)');

            improvementsList.innerHTML = improvements.slice(0, 4).map(i => `<li>${i}</li>`).join('');
        }

        function restartPractice() {
            // Don't reset questions asked - let them practise new ones
            state.selfAssessmentScores = [];
            requestCameraAccess();
            showScreen('practiceScreen');
            loadNextQuestion();
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            stopCamera();
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
            }
            // Revoke blob URLs
            state.recordings.forEach(rec => {
                if (rec.blob) {
                    URL.revokeObjectURL(URL.createObjectURL(rec.blob));
                }
            });
        });
    </script>
</body>
</html>
